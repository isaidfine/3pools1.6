# P1 设计需求：三大时代 (The Three Eras)

## 1. 背景 (Context)
在上一个版本（P0）中，我们将所有机制（刷新、合成等）在全阶段开放。
为了解决由此带来的“体验重复”问题，我们将引入 **"时代特性 (Era Traits)"**。
每个时代（Stage）将拥有独特的**全局规则**，改变玩家的最优策略。

## 2. 阶段规划 (Stage Progression)

| 阶段 | 时代代号 | 核心规则 | 具体机制 |
| :--- | :--- | :--- | :--- |
| **Stage 0** | 黄金时代 (Golden Age) |无 | **基准体验**。一切如常，让玩家熟悉系统。 |
| **Stage 1** | 波动时代 (Age of Volatility) | 价格随机 | **所有抽奖价格在 1~4 金币之间随机浮动**。每回合刷新。 |
| **Stage 2** | 专精时代 (Age of Specialization) | 种类限制 | **背包扩容至 20 格**，但**限制最多只能持有 7 种不同名称的物品**。 |
| **Stage 3** | 熵增时代 (Age of Entropy) | 物品腐烂 | **物品获得后获得 40 回合寿命**。每操作一次 -1，归零消失。 |
| **Stage 4+** | *待定* | *待定* | (暂时保持 Stage 3 规则或无规则) |

## 3. 详细需求 (Detailed Requirements)

### 3.1 Stage 1: 波动时代 (The Age of Volatility)
*   **配置开关**: 在 `currentStageConfig.mechanics` 中增加 `volatility: true`。
*   **规则逻辑**:
    *   **触发时机**: 每次 `refreshPools` (即生成新奖池) 时。
    *   **价格计算**: 每个 Pool 的 `cost` 不再读取固定的 `pool.cost`，而是在 `[1, 4]` 整数区间内随机生成。
    *   **UI表现**: 价格标签需要有明显的视觉区分（例如：低价绿色，高价红色），提示玩家当前的“汇率”。

### 3.2 Stage 2: 专精时代 (The Age of Specialization)
*   **配置开关**: 在 `currentStageConfig.mechanics` 中增加 `specialization: true`。
*   **数值调整**: 该阶段 `inventorySize` 设置为 **20**。
*   **核心定义**: "种类"指的是 **物品名称 (Item Name)**。例如：所有"苹果"算一种，所有"西瓜"算一种（无论品质/颜色如何）。
*   **规则逻辑 (Replacement)**:
    *   **触发条件**: 当玩家从奖池抽取/购买第 8 种新物品时（背包内已有 7 种不同名称的物品，且新物品名称不在其中）。
    *   **替换流程**:
        1.  暂停游戏逻辑，弹出一个模态框 **"库存过载 (Inventory Overload)"**。
        2.  展示当前背包内的 7 种物品图标。
        3.  玩家必须选择一种进行 **"清退" (Discard)**，或者选择 **"放弃新物品"**。
        4.  如果选择清退某一种类（例如"苹果"）：
            *   背包内**所有**名为"苹果"的物品被直接销毁（无收益）。
            *   新物品（第 8 种）进入背包。
*   **UI 布局要求**:
    *   **计数器**: 在 **背包区域的右上方** 或 **标题栏旁边**，显示醒目的计数器 `种类: 5/7`。颜色随数量变化（5/7 白色，6/7 黄色，7/7 红色）。
    *   **替换弹窗**: 需要清晰展示"将要为了新欢而被牺牲的旧爱"。按钮文案建议："清空所有 [苹果] 以接纳 [电脑]"。

### 3.3 Stage 3: 熵增时代 (The Age of Entropy)
*   **配置开关**: 在 `currentStageConfig.mechanics` 中增加 `entropy: true`。
*   **规则逻辑**:
    *   **寿命初始化**: 物品生成时 `decay = 40`。
    *   **寿命继承 (合成特殊处理)**: 
        *   当合成两个物品 A (寿命 10) 和 B (寿命 30) 时，生成的新物品 C 的寿命 = **Max(A, B)** = 30。
        *   *设计意图*: 鼓励用"新鲜"的低级素材去挽救"腐烂"的高级素材（或者反过来，至少不惩罚）。
    *   **腐坏 (Broken State)**:
        *   当 `decay <= 0` 时，物品**不会**消失，而是变为 **"损坏 (Broken)"** 状态。
        *   **损坏特性**:
            1.  **不可提交**: 无法用于完成订单。
            2.  **不可合成**: 无法参与合成。
            3.  **可回收**: 可以拖入回收站，**回收价格与完好时一致**。
*   **UI表现**:
    *   **倒计时**: 物品 Slot 右下角显示数字。
    *   **损坏视觉**: 物品图标**变灰/变暗**，且覆盖一个"裂纹"或"骷髅"图标。
    *   **不可用反馈**: 拖拽损坏物品到订单时，提示"物品已损坏"。

## 4. 实现建议 (Implementation Notes)

1.  **修改 `constants.js`**:
    *   更新 `INITIAL_STAGE_CONFIG`，为 Stage 1, 2, 3 分别开启对应的 mechanics 开关。
2.  **修改 `useGameLogic.js`**:
    *   **波动**: 修改 `generateActivePools`，在生成 pool 时注入随机 cost。
    *   **专精**: 在 `handleDraw` 开头增加拦截逻辑 (`if (mechanics.specialization && uniqueTypes >= 7 && !isOwned) return`).
    *   **熵增**: 创建一个新的 helper `tickEntropy()`，在所有 Action 函数末尾调用它。
3.  **修改 `GameCore.jsx` / `InventorySlot.jsx`**:
    *   增加对应的 UI 状态显示（种类计数器、倒计时角标）。

## 5. 验收标准 (Acceptance Criteria)
1.  **Stage 1 测试**: 进入 Stage 1 后，每次刷新全部，看到奖池价格在 1-4 乱跳。
2.  **Stage 2 测试**: 进入 Stage 2，买满 7 种不同水果/道具后，无法再买第 8 种从未见过的道具。
3.  **Stage 3 测试**: 进入 Stage 3，盯着一个物品不动，疯狂空刷 40 次订单，该物品应消失。
